
'use client';

import { useState } from 'react';
import { Button } from "@/components/ui/button";
import { Loader2 } from "lucide-react";
import { trackCommunityLinkClick } from '@/app/profile/community-actions';
import { useToast } from '@/hooks/use-toast';

interface CommunityAccessHubProps {
    aetherId: string;
}

type CommunityPlatform = 'Discord' | 'Telegram' | 'WhatsApp';

const DiscordIcon = () => (
    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 mr-2">
        <title>Discord</title>
        <path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4464.8245-.6667 1.284-1.7954-.3447-3.6181-.3447-5.4135 0-1.272-2.3168-2.2232-4.634-2.2232-4.634a.0739.0739 0 00-.0448-.0573 19.8256 19.8256 0 00-4.8851 1.5152.069.069 0 00-.0321.0272c-1.8932 3.6644-2.8227 7.464-2.8227 11.3323 0 3.3351 1.011 6.4523 2.8227 9.1411a.0741.0741 0 00.0849.0371c.4217-.1341.812-.2962 1.1711-.4711a.0744.0744 0 00.0448-.0614c-.0573-.2471-.1147-.4942-.1721-.7413a.0746.0746 0 00-.0299-.0573c-.2283-.1446-.4566-.2962-.6849-.4478a.0745.0745 0 00-.0849-.0074c-.5969.2471-1.1465.5413-1.6489.8634a.074.074 0 00-.0149.1045c.187.318.3815.636.576.9466a.0741.0741 0 00.0827.0423c2.4048-1.026 4.4132-2.671 5.9222-4.6979a.0745.0745 0 00.0022-.087c-.318-.4711-.6201-.9422-.9073-1.4286a.0742.0742 0 00-.0827-.0496c-.1446.0423-.2892.092-.4264.1341a12.72 12.72 0 00-1.186.4343.0746.0746 0 00-.0448.087c.0299.112.0573.224.0849.336a6.83 6.83 0 00.187.5413.0744.0744 0 00.0763.0423c.318-.0423.636-.092.9466-.1419a.0743.0743 0 00.0595-.087c-.0573-.2048-.1072-.4096-.157-.6143a.0744.0744 0 00-.0614-.0763c-.4566-.1193-.9207-.211-1.3848-.2784a.0743.0743 0 00-.0849.0496c-.464.9422-.8784 1.9142-1.2375 2.9135a.0746.0746 0 00.0044.087c.2356.2471.4942.4868.7602.7112a.0743.0743 0 00.092.0022c.4217-.2471.8194-.5114 1.1934-.7986a.0744.0744 0 00.0423-.0827c-.0224-.0763-.0448-.1527-.0672-.224a.0743.0743 0 00-.0528-.0573c-1.8103-.7112-3.21-1.7458-4.1639-3.0454a.0744.0744 0 00-.0849-.0149c-.5895.224-1.139.4942-1.6415.7986a.0744.0744 0 00-.0448.0763c.092.3447.1943.682.2966.1.0125a.0742.0742 0 00.0763.0614c.3753-.1419.7431-.2962 1.1023-.4566a.0744.0744 0 00.0595-.0687c.0074-.0496-.0149-.0992-.0448-.1341a.074.074 0 00-.0614-.0371c-.0496.0074-.0992.0149-.149.0224a.0743.0743 0 00-.0371.0149c-1.7631 1.0532-3.2324 2.383-4.3414 4.0044a.0745.0745 0 00.0149.092c.567.4343 1.186.8268 1.8327 1.1578a.0744.0744 0 00.0872-.0044c.4868-.318.949-.682 1.3848-1.0746a.0743.0743 0 00.0299-.0827c-.0849-.2471-.1625-.4942-.2356-.7487a.0744.0744 0 00-.0741-.0614c-.2356.0224-.464.0496-.6923.0827a14.062 14.062 0 00-1.488.318.0743.0743 0 00-.0573.087c.0371.1419.0827.2815.1209.4217.0149.0496.0423.0849.0763.1045.3031.1721.6136.3372.9315.4868a.0744.0744 0 00.0827.0044c.5969-.318 1.1667-.682 1.7066-1.0746a.0743.0743 0 00.0299-.0827c-.0573-.187-.1147-.3753-.1721-.567a.0743.0743 0 00-.0741-.0614c-1.026.2471-2.0297.5562-2.9836.9073a.0745.0745 0 00-.0573.0827c.0573.187.1147.3753.1721.567a.0743.0743 0 00.0763.0614c.4711-.1419.9348-.2962 1.3922-.4566a.0744.0744 0 00.0614-.0763c.0074-.0496-.0149-.0992-.0448-.1341a.074.074 0 00-.0614-.0371c-.2471.0423-.4868.0849-.7254.1341a.0743.0743 0 00-.0595.0849c-.0074.0224.0074.0423.0224.0573.8046.5413 1.6242 1.0185 2.4737 1.4424a.0744.0744 0 00.0894-.0022 19.8256 19.8256 0 003.6181 1.0532.0744.0744 0 00.0849-.0614 16.148 16.148 0 00.7454-3.1118.074.074 0 00-.0448-.092c-.4464-.1721-.8928-.3447-1.3243-.5339a.0744.0744 0 00-.0872.0149c-.211.211-.4143.4343-.6136.6575a.0745.0745 0 00-.0224.0827c.0573.1796.1147.3592.1796.5339a.0743.0743 0 00.0741.0573c.4868-.0849.9662-.1943 1.4348-.318a.0744.0744 0 00.0638-.0827c-.0299-.112-.0573-.224-.092-.336a.0743.0743 0 00-.0687-.0573c-.211.0299-.4217.0573-.6275.092a14.0735 14.0735 0 00-1.4656.3946.0743.0743 0 00-.0595.0849c.0074.0149.0224.0371.0371.0496.1419.1419.2892.2815.4343.4143.2048.187.4343.3592.6775.5114a.0745.0745 0 00.0942-.0022c3.4239-2.3168 5.688-5.4556 6.577-9.0436a.0746.0746 0 00-.0299-.0849Z" fill="currentColor"/>
    </svg>
);

const TelegramIcon = () => (
    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 mr-2">
        <title>Telegram</title>
        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.018-.65-1.59-1.025-2.577-1.674-.936-.613-1.649-1.01-1.803-1.123-.274-.202-.488-.325-.432-.636.033-.18.232-.364.673-.59.72-.375 1.212-.612 1.212-.612s.37-.221.34-.472c-.03-.25-.34-.14-.34-.14-1.288.854-2.222 1.483-2.913 1.954-.423.284-.736.417-1.12.392-.47-.03-.92-.15-1.28-.293-.41-.165-.72-.348-.6-.622.25-.561 1.22-1.948 1.9-2.928.652-.922 1.26-1.928 1.26-1.928s.16-.39.43-.497c.27-.107.57-.015.57-.015l5.022.001z" fill="currentColor"/>
    </svg>
);

const WhatsAppIcon = () => (
    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 mr-2">
        <title>WhatsApp</title>
        <path d="M12.01 2.019c-5.523 0-10 4.477-10 10 0 1.758.459 3.45 1.32 4.908L2.01 22.01l5.228-1.324a9.942 9.942 0 0 0 4.762 1.314h.01a10 10 0 1 0-10-10.01zm0 18.21c-1.636 0-3.21-.42-4.61-1.23L3.89 20.4l1.4-3.52c-.89-1.46-1.39-3.13-1.39-4.88 0-4.54 3.69-8.23 8.23-8.23 4.54 0 8.23 3.69 8.23 8.23s-3.69 8.23-8.23 8.23zm4.51-6.19c-.25-.12-1.47-.72-1.69-.81-.23-.08-.39-.12-.56.12-.17.25-.64.81-.78.97-.14.17-.28.18-.53.06-.25-.12-1.05-.39-2-1.23-.74-.66-1.23-1.48-1.38-1.73s-.03-.23.09-.34c.11-.11.25-.28.37-.42.12-.14.17-.25.25-.41.08-.17.04-.31-.02-.43s-.56-1.34-.76-1.84c-.2-.48-.4-.42-.56-.42-.15 0-.31-.01-.48-.01s-.43.06-.66.31c-.22.25-.87.85-1.07 2.05-.2 1.21.08 2.39.25 2.6.17.22.9 1.41 2.18 2.9.3.36.54.57.78.75.29.23.54.38.74.49.25.13.5.21.78.27.35.08.67.04 1-.02.36-.07 1.05-.43 1.2-1.03.15-.58.15-1.08.11-1.18s-.17-.18-.42-.3z" fill="currentColor"/>
    </svg>
);


export function CommunityAccessHub({ aetherId }: CommunityAccessHubProps) {
    const { toast } = useToast();
    const [loadingPlatform, setLoadingPlatform] = useState<CommunityPlatform | null>(null);

    const handleCommunityClick = async (platform: CommunityPlatform) => {
        setLoadingPlatform(platform);
        try {
            const result = await trackCommunityLinkClick(aetherId, platform);
            if (result.success && result.url) {
                if (result.url === '#') {
                     toast({
                        title: 'Coming Soon!',
                        description: `The ${platform} community link is not available yet.`,
                    });
                } else {
                    window.open(result.url, '_blank', 'noopener,noreferrer');
                }
            } else {
                throw new Error(result.error || `Could not get ${platform} link.`);
            }
        } catch (error: any) {
            toast({
                title: 'Error',
                description: error.message,
                variant: 'destructive',
            });
        } finally {
            setLoadingPlatform(null);
        }
    };
    
    const communityPlatforms: { name: CommunityPlatform, icon: React.ComponentType, style: string }[] = [
        { name: 'Discord', icon: DiscordIcon, style: 'bg-[#5865F2] hover:bg-[#5865F2]/90 text-white' },
        { name: 'Telegram', icon: TelegramIcon, style: 'bg-[#2AABEE] hover:bg-[#2AABEE]/90 text-white' },
        { name: 'WhatsApp', icon: WhatsAppIcon, style: 'bg-[#25D366] hover:bg-[#25D366]/90 text-white' },
    ];

    return (
        <>
            {communityPlatforms.map(platform => {
                const isLoading = loadingPlatform === platform.name;
                return (
                    <Button 
                        key={platform.name}
                        className={`w-full justify-start ${platform.style}`}
                        onClick={() => handleCommunityClick(platform.name)}
                        disabled={isLoading}
                    >
                        {isLoading ? (
                            <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                        ) : (
                            <platform.icon />
                        )}
                        Join {platform.name}
                    </Button>
                )
            })}
        </>
    )
}
